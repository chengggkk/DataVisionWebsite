import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np
from matplotlib import font_manager
import warnings
warnings.filterwarnings('ignore')

# 設置中文字體
plt.rcParams['font.sans-serif'] = ['Microsoft JhengHei', 'Arial Unicode MS', 'SimHei']
plt.rcParams['axes.unicode_minus'] = False

# 直接在程式碼中定義數據（修正版本）
crime_data = [
    # 104年 (2015年)
    [65000, '新北市', 822.1, 572.13, 1167.6, 914.25, 2015],
    [63000, '臺北市', 1477.72, 743.06, 2526.74, 1658.08, 2015],
    [68000, '桃園市', 808.19, 505.33, 1114.89, 936.15, 2015],
    [66000, '臺中市', 923.53, 611.45, 1190.1, 1070.72, 2015],
    [67000, '臺南市', 1204.67, 575.53, 1632.68, 1369.71, 2015],
    [64000, '高雄市', 1072.17, 670.72, 1552.08, 1192.39, 2015],
    [10002, '宜蘭縣', 1461.24, 829.91, 1704.59, 1680.7, 2015],
    [10004, '新竹縣', 1089.96, 1042.82, 1458.8, 1251.36, 2015],
    [10005, '苗栗縣', 1152.21, 705.68, 1171.57, 1361.62, 2015],
    [10007, '彰化縣', 1093.8, 555.3, 1147.9, 1297.85, 2015],
    [10008, '南投縣', 1152.76, 713.27, 1123.62, 1330.09, 2015],
    [10009, '雲林縣', 1077.59, 528.49, 1035.71, 1266.91, 2015],
    [10010, '嘉義縣', 1321.43, 795.21, 1378.81, 1493.63, 2015],
    [10013, '屏東縣', 1299.57, 632.3, 1458.68, 1484.69, 2015],
    [10014, '臺東縣', 1481.69, 1357.99, 1941.49, 1624.19, 2015],
    [10015, '花蓮縣', 1723.94, 1305.2, 2653.21, 1874.01, 2015],
    [10016, '澎湖縣', 1003.62, 641.82, 1308.11, 1110.31, 2015],
    [10017, '基隆市', 1815.4, 1305.69, 2374.02, 1988.36, 2015],
    [10018, '新竹市', 1186.31, 788.88, 2358.47, 1334.93, 2015],
    [10020, '嘉義市', 1342.82, 893.84, 1800.22, 1541.54, 2015],
    [9020, '金門縣', 730.84, 1144.13, 1218.57, 718.08, 2015],
    [9007, '連江縣', 367.22, np.nan, 490.44, 430.94, 2015],  # 修正：少年犯罪率為空值
    
    # 105年 (2016年)
    [65000, '新北市', 817.17, 555.61, 1359.01, 887.36, 2016],
    [63000, '臺北市', 1535.3, 717.59, 2636.15, 1725.74, 2016],
    [68000, '桃園市', 787.06, 426.63, 1105.04, 916, 2016],
    [66000, '臺中市', 960.32, 470.39, 1338.3, 1115.76, 2016],
    [67000, '臺南市', 1174.74, 521.4, 1660.71, 1328.15, 2016],
    [64000, '高雄市', 1033.59, 643.55, 1621.79, 1133.44, 2016],
    [10002, '宜蘭縣', 1607.81, 1075.16, 1997.96, 1810.5, 2016],
    [10004, '新竹縣', 1188.59, 774.2, 1706.82, 1387.05, 2016],
    [10005, '苗栗縣', 1106.04, 604.63, 1076.98, 1309.77, 2016],
    [10007, '彰化縣', 1176.76, 604.07, 1253.98, 1387.87, 2016],
    [10008, '南投縣', 1221.5, 762.4, 1304.65, 1388.75, 2016],
    [10009, '雲林縣', 1130.87, 496.18, 1147, 1322.46, 2016],
    [10010, '嘉義縣', 1370.61, 739.71, 1668, 1524.18, 2016],
    [10013, '屏東縣', 1299.55, 637.99, 1426.97, 1480.68, 2016],
    [10014, '臺東縣', 1395.14, 1079.49, 1914.32, 1531.73, 2016],
    [10015, '花蓮縣', 1776.25, 1177.36, 2876.12, 1928.46, 2016],
    [10016, '澎湖縣', 1114.96, 1488.71, 1549.77, 1159.31, 2016],
    [10017, '基隆市', 1730.97, 1179.58, 2775.96, 1842.65, 2016],
    [10018, '新竹市', 1132.66, 726.19, 2232.07, 1275.45, 2016],
    [10020, '嘉義市', 1406.78, 870.31, 1947.95, 1607.34, 2016],
    [9020, '金門縣', 823.4, 1179.53, 1017.01, 867.34, 2016],
    [9007, '連江縣', 485.24, 445.43, 601.2, 542.12, 2016],
    
    # 106年 (2017年)
    [65000, '新北市', 947.99, 734.09, 1715.98, 1007.98, 2017],
    [63000, '臺北市', 1523.71, 805.1, 2754.9, 1694.2, 2017],
    [68000, '桃園市', 845.38, 420.62, 1207.43, 983.85, 2017],
    [66000, '臺中市', 964.76, 498.74, 1473.38, 1100.73, 2017],
    [67000, '臺南市', 1319.85, 592.97, 1974.74, 1478.86, 2017],
    [64000, '高雄市', 1133.53, 705.2, 1785.78, 1241.41, 2017],
    [10002, '宜蘭縣', 1754.65, 1127.97, 2275.6, 1963.04, 2017],
    [10004, '新竹縣', 1256.76, 797.11, 1825.72, 1465.36, 2017],
    [10005, '苗栗縣', 1212.04, 708.3, 1492.55, 1390.26, 2017],
    [10007, '彰化縣', 1267.67, 764.24, 1448.74, 1466.62, 2017],
    [10008, '南投縣', 1251.42, 1004.42, 1683.39, 1361.8, 2017],
    [10009, '雲林縣', 1140.88, 505.42, 1397.08, 1302.32, 2017],
    [10010, '嘉義縣', 1367.95, 647.78, 1633.44, 1522.95, 2017],
    [10013, '屏東縣', 1347.76, 733.29, 1696.6, 1502.18, 2017],
    [10014, '臺東縣', 1153.19, 750.35, 1470.55, 1288.03, 2017],
    [10015, '花蓮縣', 1685.38, 1380.83, 2501.46, 1821.97, 2017],
    [10016, '澎湖縣', 1085.2, 1605.36, 1795.46, 1082.28, 2017],
    [10017, '基隆市', 1841.95, 1406.98, 3123.87, 1930.67, 2017],
    [10018, '新竹市', 989.22, 708, 2062.13, 1094.87, 2017],
    [10020, '嘉義市', 1490.53, 676.44, 2026.44, 1727.65, 2017],
    [9020, '金門縣', 697.07, 1069.52, 1163.96, 688.92, 2017],
    [9007, '連江縣', 463.2, np.nan, 513.61, 551.08, 2017],  # 修正：少年犯罪率為空值
    
    # 107年 (2018年)
    [65000, '新北市', 920, 610.64, 1536.59, 997.64, 2018],
    [63000, '臺北市', 1647.81, 715.21, 2868.73, 1847.37, 2018],
    [68000, '桃園市', 829.73, 337.74, 1007.82, 990.06, 2018],
    [66000, '臺中市', 962.37, 556.37, 1549.62, 1081.61, 2018],
    [67000, '臺南市', 1346.29, 574.17, 2079.96, 1499.8, 2018],
    [64000, '高雄市', 1124.31, 604.52, 1740.74, 1238.47, 2018],
    [10002, '宜蘭縣', 1605.79, 1012.93, 1928.79, 1809.88, 2018],
    [10004, '新竹縣', 1385.89, 797.88, 1585.5, 1670.51, 2018],
    [10005, '苗栗縣', 1149.21, 592.63, 1464.38, 1310.38, 2018],
    [10007, '彰化縣', 1311.81, 665.69, 1500.26, 1523.5, 2018],
    [10008, '南投縣', 1280.26, 1041.6, 1843.49, 1374.06, 2018],
    [10009, '雲林縣', 1215.93, 465.72, 1599.19, 1372.74, 2018],
    [10010, '嘉義縣', 1556, 719.13, 1688.27, 1743.46, 2018],
    [10013, '屏東縣', 1364.07, 629.64, 1588.29, 1535.87, 2018],
    [10014, '臺東縣', 1431.83, 891.99, 1916.68, 1593.21, 2018],
    [10015, '花蓮縣', 1872.17, 1111.99, 2995.4, 2034.68, 2018],
    [10016, '澎湖縣', 1043.58, 840.1, 1270.23, 1135.4, 2018],
    [10017, '基隆市', 1864.58, 1106.31, 2779.13, 2016.6, 2018],
    [10018, '新竹市', 1077.62, 711.93, 2343.88, 1188.88, 2018],
    [10020, '嘉義市', 1472.44, 538.73, 2005.89, 1710.01, 2018],
    [9020, '金門縣', 733.57, 384.02, 820.08, 813.64, 2018],
    [9007, '連江縣', 840.53, 504.2, 713.56, 981.07, 2018],
    
    # 108年 (2019年)
    [65000, '新北市', 797.41, 699.49, 1380.03, 845.88, 2019],
    [63000, '臺北市', 1596.35, 837.71, 2957.81, 1762.25, 2019],
    [68000, '桃園市', 808.52, 345.18, 1054.14, 951.91, 2019],
    [66000, '臺中市', 981.32, 557.16, 1642.14, 1093.26, 2019],
    [67000, '臺南市', 1307.24, 734.64, 2077.87, 1433.16, 2019],
    [64000, '高雄市', 1113.63, 667.46, 1756.45, 1215.44, 2019],
    [10002, '宜蘭縣', 1495.93, 1126.41, 2153.46, 1632.44, 2019],
    [10004, '新竹縣', 1148.5, 721.82, 1603.91, 1341.75, 2019],
    [10005, '苗栗縣', 936.1, 536.27, 1265.41, 1050.11, 2019],
    [10007, '彰化縣', 1197.9, 729.65, 1573.73, 1352.89, 2019],
    [10008, '南投縣', 1337.85, 1148.41, 2037.03, 1419.59, 2019],
    [10009, '雲林縣', 1272.12, 594.7, 1659.5, 1423.18, 2019],
    [10010, '嘉義縣', 1552, 977.89, 2274.39, 1653.42, 2019],
    [10013, '屏東縣', 1253.08, 709.2, 1610.51, 1381.1, 2019],
    [10014, '臺東縣', 1425.75, 844.91, 2076.64, 1560.43, 2019],
    [10015, '花蓮縣', 1942.79, 1933, 3439.7, 2021.8, 2019],
    [10016, '澎湖縣', 1102.81, 1635.42, 1832.43, 1090.27, 2019],
    [10017, '基隆市', 1589.34, 1144.31, 2674.38, 1670.72, 2019],
    [10018, '新竹市', 1109.3, 541.18, 1951.85, 1287.68, 2019],
    [10020, '嘉義市', 1316.03, 664.7, 2401.95, 1435.04, 2019],
    [9020, '金門縣', 790.82, 900.99, 1170.32, 814.21, 2019],
    [9007, '連江縣', 596.67, 706.09, 393.89, 685.2, 2019],
    
    # 109年 (2020年)
    [65000, '新北市', 647.9, 515.75, 1163.69, 688.93, 2020],
    [63000, '臺北市', 1692.21, 1097.23, 3502.34, 1824.81, 2020],
    [68000, '桃園市', 857.8, 463.15, 1172.22, 993.02, 2020],
    [66000, '臺中市', 1007.98, 635.09, 1782.46, 1107.36, 2020],
    [67000, '臺南市', 1475.84, 800.53, 2307.62, 1624.39, 2020],
    [64000, '高雄市', 1132.49, 792.36, 2031.08, 1207.04, 2020],
    [10002, '宜蘭縣', 1696.75, 1538.21, 2487.74, 1830.21, 2020],
    [10004, '新竹縣', 1325.63, 866, 1958.85, 1534.5, 2020],
    [10005, '苗栗縣', 895.92, 477.66, 1243.04, 1003.07, 2020],
    [10007, '彰化縣', 1239.63, 827.48, 1781.08, 1377.02, 2020],
    [10008, '南投縣', 1366.17, 1326.36, 2077.31, 1439.32, 2020],
    [10009, '雲林縣', 1277.89, 700.97, 1888.82, 1397.02, 2020],
    [10010, '嘉義縣', 1648.52, 995.56, 2582.94, 1741.08, 2020],
    [10013, '屏東縣', 1215.31, 912.88, 1864.55, 1295.53, 2020],
    [10014, '臺東縣', 1280.89, 974.43, 2162.1, 1360.38, 2020],
    [10015, '花蓮縣', 1467.83, 1786.69, 2647.82, 1501.11, 2020],
    [10016, '澎湖縣', 1253.08, 1349.36, 1701.21, 1326.46, 2020],
    [10017, '基隆市', 1637.27, 2041.54, 2980.1, 1650.5, 2020],
    [10018, '新竹市', 1047.31, 676.27, 2025.2, 1178.25, 2020],
    [10020, '嘉義市', 1442.02, 1276.75, 2386.61, 1548.87, 2020],
    [9020, '金門縣', 902.48, 807.8, 1198.53, 958.31, 2020],
    [9007, '連江縣', 849.51, 1264.68, 866.22, 928.52, 2020],
    
    # 110年 (2021年)
    [65000, '新北市', 507.37, 370.06, 951.39, 539.27, 2021],
    [63000, '臺北市', 1561.98, 959.31, 3517.71, 1667.22, 2021],
    [68000, '桃園市', 875.28, 486.35, 1403.01, 989.19, 2021],
    [66000, '臺中市', 1004.03, 759.02, 1936.22, 1078.4, 2021],
    [67000, '臺南市', 1483.23, 852.39, 2526, 1612.1, 2021],
    [64000, '高雄市', 1062.13, 881.14, 1995.16, 1117.86, 2021],
    [10002, '宜蘭縣', 1796.01, 1497.68, 3362.3, 1881.73, 2021],
    [10004, '新竹縣', 1087.45, 688.88, 1734.71, 1247.14, 2021],
    [10005, '苗栗縣', 897.88, 585.02, 1344.21, 986.28, 2021],
    [10007, '彰化縣', 1204.92, 786.59, 1845.31, 1327.98, 2021],
    [10008, '南投縣', 1424.78, 951.9, 2419.51, 1511.75, 2021],
    [10009, '雲林縣', 1204.3, 890.61, 1881.78, 1290.07, 2021],
    [10010, '嘉義縣', 1527.6, 940.61, 2378.16, 1612.84, 2021],
    [10013, '屏東縣', 1135.24, 968.69, 1723.6, 1206.49, 2021],
    [10014, '臺東縣', 1107.67, 982.03, 1758.07, 1179.6, 2021],
    [10015, '花蓮縣', 1112.54, 1056.23, 1749.25, 1188.68, 2021],
    [10016, '澎湖縣', 1256.76, 1141.58, 1816.33, 1334.02, 2021],
    [10017, '基隆市', 1604.53, 2020.79, 2859.13, 1629.42, 2021],
    [10018, '新竹市', 1064.54, 778.39, 2248.37, 1172.39, 2021],
    [10020, '嘉義市', 1563.12, 1148.92, 2830, 1674.99, 2021],
    [9020, '金門縣', 1046.3, 1070.92, 2154.23, 1025.81, 2021],
    [9007, '連江縣', 950.82, 744.19, 768.12, 1088.08, 2021],
    
    # 111年 (2022年)
    [65000, '新北市', 717.52, 520.81, 1213.37, 773.97, 2022],
    [63000, '臺北市', 1673.14, 933.48, 3683.63, 1796.17, 2022],
    [68000, '桃園市', 1074.47, 645.45, 1711.58, 1209.12, 2022],
    [66000, '臺中市', 1030.39, 724.36, 2004.07, 1110.22, 2022],
    [67000, '臺南市', 1579.36, 713.88, 2993.66, 1704.47, 2022],
    [64000, '高雄市', 970.03, 699.23, 1761.76, 1033.88, 2022],
    [10002, '宜蘭縣', 1847.17, 1466.66, 3265.61, 1960.82, 2022],
    [10004, '新竹縣', 1160.99, 841.05, 1674.88, 1338.48, 2022],
    [10005, '苗栗縣', 1231.89, 841.72, 1712.88, 1360.45, 2022],
    [10007, '彰化縣', 1312.34, 873.91, 1856.56, 1457.17, 2022],
    [10008, '南投縣', 1777.1, 1086.91, 3002.04, 1894.23, 2022],
    [10009, '雲林縣', 1457.78, 1091.91, 2383.23, 1549.76, 2022],
    [10010, '嘉義縣', 1675.64, 1158.84, 2558.3, 1765.72, 2022],
    [10013, '屏東縣', 1204.88, 787.06, 1757.4, 1301.83, 2022],
    [10014, '臺東縣', 1456.55, 1340.11, 2489.63, 1534.11, 2022],
    [10015, '花蓮縣', 1468.18, 1526.77, 2745.19, 1523.45, 2022],
    [10016, '澎湖縣', 1253.96, 1181.89, 2076.01, 1301.31, 2022],
    [10017, '基隆市', 1734.8, 1486.2, 3154.4, 1802.11, 2022],
    [10018, '新竹市', 1057.33, 727.14, 1920.73, 1195.75, 2022],
    [10020, '嘉義市', 1840.99, 1070.57, 3359.59, 1991.17, 2022],
    [9020, '金門縣', 1148.38, 746.81, 1777.07, 1202.26, 2022],
    [9007, '連江縣', 1172.72, 916.59, 2609.96, 1176.74, 2022],
    
    # 112年 (2023年) - 修正金門縣和連江縣的縣市代碼
    [65000, '新北市', 888.6, 768.58, 1589.1, 943.73, 2023],
    [63000, '臺北市', 1788.58, 1066.41, 3991.78, 1911.21, 2023],
    [68000, '桃園市', 911.43, 587.2, 1398.06, 1025.42, 2023],
    [66000, '臺中市', 992.83, 850.4, 2035.49, 1050.43, 2023],
    [67000, '臺南市', 1588.17, 913.14, 3216.97, 1687.44, 2023],
    [64000, '高雄市', 882.94, 704.49, 1614.35, 936.82, 2023],
    [10002, '宜蘭縣', 1820.12, 1748.51, 3221.32, 1914.73, 2023],
    [10004, '新竹縣', 1049.59, 676.52, 1666.71, 1200.67, 2023],
    [10005, '苗栗縣', 1367.85, 1035.88, 2144.25, 1480.79, 2023],
    [10007, '彰化縣', 1475.11, 1143.78, 2227.43, 1611.5, 2023],
    [10008, '南投縣', 1767.97, 1324.06, 3153.43, 1856.75, 2023],
    [10009, '雲林縣', 1332.92, 842.92, 2098.23, 1433.33, 2023],
    [10010, '嘉義縣', 1662.35, 1324.05, 2778.41, 1722.9, 2023],
    [10013, '屏東縣', 1210.77, 863.03, 1913.21, 1292.65, 2023],
    [10014, '臺東縣', 1597.28, 1990.96, 2626.51, 1661.96, 2023],
    [10015, '花蓮縣', 1295.76, 1415.22, 2386.96, 1345.1, 2023],
    [10016, '澎湖縣', 1499.8, 1640.95, 2819.49, 1512.49, 2023],
    [10017, '基隆市', 1746.94, 1844.47, 2847.47, 1823.82, 2023],
    [10018, '新竹市', 1303.48, 950.13, 2478.72, 1454.57, 2023],
    [10020, '嘉義市', 1865.5, 979.31, 3583.33, 2008.26, 2023],
    [9020, '金門縣', 974.62, 1630.55, 2051.51, 925.58, 2023],  # 修正：原始數據中縣市代碼為9020
    [9007, '連江縣', 1249.02, 1224.85, 3815.26, 1151.61, 2023],  # 修正：原始數據中縣市代碼為9007
]

# 創建DataFrame
df = pd.DataFrame(crime_data, columns=['縣市代碼', '縣市', '總犯罪率', '少年犯罪率', '青年犯罪率', '成年犯罪率', '年份'])
plt.figure(figsize=(8, 6))
yearly_avg = df.groupby('年份')['總犯罪率'].mean()
yearly_change = yearly_avg.pct_change() * 100

bars = plt.bar(yearly_change.index[1:], yearly_change.values[1:], 
              color=['red' if x < 0 else 'green' for x in yearly_change.values[1:]], alpha=0.7)
plt.title('全國平均犯罪率年度變化率', fontsize=14, fontweight='bold', pad=20)
plt.xlabel('年份', fontsize=12)
plt.ylabel('變化率 (%)', fontsize=12)
plt.axhline(y=0, color='black', linestyle='-', linewidth=0.8)
plt.grid(True, alpha=0.3, axis='y')

for bar, value in zip(bars, yearly_change.values[1:]):
    height = bar.get_height()
    plt.text(bar.get_x() + bar.get_width()/2., height + (0.5 if height >= 0 else -0.5), 
             f'{value:.1f}%', ha='center', va='bottom' if height >= 0 else 'top', fontweight='bold')
plt.tight_layout()
plt.show()